<!doctype html>
<html lang="en">

<head>

	<style>
		/* Category Filter Styles */
		.category-pills {
			white-space: nowrap;
			padding: 20px 0;
			margin-bottom: 30px;
			border-bottom: 1px solid #eee;
		}

		.category-pills .nav-pills {
			display: flex;
			gap: 15px;
			overflow-x: auto;
			padding-bottom: 10px;
			-ms-overflow-style: none;
			/* Hide scrollbar IE and Edge */
			scrollbar-width: none;
			/* Hide scrollbar Firefox */
		}

		.category-pills .nav-pills::-webkit-scrollbar {
			display: none;
			/* Hide scrollbar Chrome, Safari and Opera */
		}

		.category-pills .nav-link {
			color: #2f2f2f;
			background: none;
			border: 1px solid #2f2f2f;
			border-radius: 20px;
			padding: 8px 20px;
			transition: all 0.3s ease;
			white-space: nowrap;
		}

		.category-pills .nav-link.active {
			background-color: #2f2f2f;
			color: white;
		}

		.category-pills .nav-link:hover:not(.active) {
			background-color: rgba(47, 47, 47, 0.1);
		}

		/* Filter Section Styles */
		.filter-section {
			padding: 20px 0;
			margin-bottom: 30px;
			background-color: #f8f9fa;
			border-radius: 8px;
		}

		.filter-section .form-select {
			border: 1px solid #2f2f2f;
			padding: 10px 15px;
			border-radius: 4px;
		}

		/* Product Grid Styles */
		.product-card {
			transition: transform 0.3s ease;
			margin-bottom: 30px;
		}

		.product-card:hover {
			transform: translateY(-5px);
		}

		.product-thumbnail {
			height: 300px;
			object-fit: cover;
		}

		/* Dropdown Styles */
		.dropdown-toggle {
			background-color: #2f2f2f;
			border: none;
			padding: 10px 20px;
			transition: all 0.3s ease;
		}

		.dropdown-toggle:hover,
		.dropdown-toggle:focus {
			background-color: #000000;
		}

		.dropdown-item {
			padding: 8px 20px;
			color: #2f2f2f;
		}

		.dropdown-item.active,
		.dropdown-item:active {
			background-color: #2f2f2f;
			color: white;
		}

		.dropdown-item:hover:not(.active) {
			background-color: rgba(47, 47, 47, 0.1);
		}

		/* Make dropdown scrollable if too many categories */
		.dropdown-menu {
			max-height: 300px;
			overflow-y: auto;
			border-radius: 4px;
			border: 1px solid rgba(47, 47, 47, 0.1);
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}

		/* Badge styling */
		.badge.bg-danger {
			background-color: #dc3545 !important;
			font-weight: normal;
			padding: 4px 8px;
		}

		/* Responsive adjustments */
		@media (max-width: 768px) {
			.category-pills {
				margin-top: 20px;
			}

			.category-pills .nav {
				justify-content: flex-start;
			}
		}

		.nav-pills .nav-link.active,
		.nav-pills .show>.nav-link {
			background-color: #2f2f2f !important;
			/* Dark theme color */
			color: white !important;
		}

		.nav-pills .nav-link {
			color: #2f2f2f;
		}

		.nav-pills .nav-link:hover {
			color: #000000;
		}

		/* Override Bootstrap's default focus color */
		.nav-pills .nav-link:focus {
			box-shadow: 0 0 0 0.25rem rgba(47, 47, 47, 0.25) !important;
		}

		.sort-dropdown {
			border: 1px solid #2f2f2f;
			padding: 8px 15px;
			border-radius: 4px;
			color: #2f2f2f;
			cursor: pointer;
			transition: all 0.3s ease;
			width: 100%;
		}

		.sort-dropdown:hover {
			background-color: rgba(47, 47, 47, 0.05);
		}

		.sort-dropdown:focus {
			outline: none;
			box-shadow: 0 0 0 0.25rem rgba(47, 47, 47, 0.25);
		}

		@media (max-width: 768px) {
			.sort-dropdown {
				margin-top: 10px;
			}
		}


		#priceSort {
			margin-left: 50%;
			width: 200px;

		}


		@media screen and (max-width: 1200px) {
			#priceSort {
				margin-left: 40%;
			}
		}

		@media screen and (max-width: 992px) {
			#priceSort {
				margin-left: 30%;
			}
		}

		@media screen and (max-width: 768px) {
			#priceSort {
				margin-left: 20%;
				width: 180px;
			}
		}

		@media screen and (max-width: 576px) {
			#priceSort {
				margin-left: 0;
				width: 150px;
			}
		}


		@media screen and (max-width: 375px) {
			#priceSort {
				width: 120px;
			}
		}

		.search-bar {
			position: relative;
		}

		.search-bar form {
			display: flex;
			align-items: center;
		}

		.search-bar .form-control {
			border: 1px solid #2f2f2f;
			padding: 10px 15px;
			border-radius: 4px;
		}

		.search-bar .btn {
			padding: 10px 20px;
			border-radius: 4px;
		}

		.search-bar .btn:hover {
			background-color: #000;
		}


		.filter-section {
			padding: 20px;
			margin-bottom: 30px;
			background-color: #f8f9fa;
			border-radius: 8px;
		}
	</style>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


	<meta name="description" content="" />
	<meta name="keywords" content="bootstrap, bootstrap4" />

	<!-- Bootstrap CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	<link href="css/tiny-slider.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<title>shop</title>
</head>

<body>
	<%- include("../partials/user/header") %>

		<!-- Hero Section -->
		<div class="hero">
			<div class="container">
				<div class="row justify-content-between">
					<div class="col-lg-12">
						<div class="intro-excerpt text-center">
							<h1>Our Collection</h1>
							<p>Discover timeless pieces that define your style</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Main Content -->
		<div class="container">
			<!-- Category Pills -->
			<div class="category-pills">
				<ul class="nav nav-pills">
					<li class="nav-item">
						<a class="nav-link <%= !selectedCategory ? 'active' : '' %>" href="/shop">
							All Products
						</a>
					</li>
					<% categories.forEach(category=> { %>
						<li class="nav-item">
							<a class="nav-link <%= selectedCategory === category._id.toString() ? 'active' : '' %>"
								href="/shop?category=<%= category._id %>">
								<%= category.name %>
									<% if (category.categoryOffer> 0) { %>
										<span class="badge bg-danger ms-1">
											<%= category.categoryOffer %>% OFF
										</span>
										<% } %>
							</a>
						</li>
						<% }) %>
				</ul>
			</div>

			<!-- Filter Section -->
			<div class="filter-section">
				<div class="row g-3 align-items-center">

					<!-- Search Bar -->
					<div class="col-md-4">
						<div class="search-bar">
							<form action="/shop" method="GET" class="d-flex">
								<input type="search" class="form-control" placeholder="Search products..." name="search"
									value="<%= searchQuery || '' %>" aria-label="Search">
								<button class="btn btn-dark ms-2" type="submit">
									<i class="fas fa-search"></i>
								</button>
							</form>
						</div>
					</div>
					<div class="col-md-4">
						<select class="form-select" id="priceFilter" onchange="filterByPrice(this.value)">
							<option value="">Filter by Price</option>
							<option value="500-1000" <%=selectedPriceRange==='500-1000' ? 'selected' : '' %>>₹500 -
								₹1,000</option>
							<option value="1000-5000" <%=selectedPriceRange==='1000-5000' ? 'selected' : '' %>>₹1,000 -
								₹5,000</option>
							<option value="5000-above" <%=selectedPriceRange==='5000-above' ? 'selected' : '' %>>₹5,000
								& Above</option>
						</select>
					</div>
					<div class="col-md-4 ms-auto">
						<select class="form-select" id="priceSort" onchange="sortProducts(this.value)">
							<option value="">Sort by</option>
							<option value="low" <%=selectedSort==='low' ? 'selected' : '' %>>Price: Low to High</option>
							<option value="high" <%=selectedSort==='high' ? 'selected' : '' %>>Price: High to Low
							</option>
							<option value="asc" <%=selectedSort==='asc' ? 'selected' : '' %>>Name: A to Z</option>
							<option value="desc" <%=selectedSort==='desc' ? 'selected' : '' %>>Name: Z to A</option>
						</select>
					</div>
				</div>
			</div>

			<!-- Product Grid -->
			<div class="row">
				<% if (products && products.length> 0) { %>
					<% products.forEach(product=> { %>
						<div class="col-12 col-md-6 col-lg-4">
							<div class="card product-card h-100">
								<a href="/productDetails?id=<%= product._id %>" class="text-decoration-none">
									<% if (product.productImage && product.productImage.length> 0) { %>
										<img src="/uploads/product-images/<%= product.productImage[0] %>"
											alt="<%= product.productName %>" class="card-img-top product-thumbnail">
										<% } else { %>
											<img src="/images/placeholder.jpg" alt="No image available"
												class="card-img-top product-thumbnail">
											<% } %>
												<div class="card-body">
													<h5 class="card-title">
														<%= product.productName %>
													</h5>
													<div class="d-flex justify-content-between align-items-center">
														<div>
															<strong class="text-success">₹<%= product.salePrice %>
															</strong>
															<% if (product.regularPrice> product.salePrice) { %>
																<small
																	class="text-muted text-decoration-line-through ms-2">
																	₹<%= product.regularPrice %>
																</small>
																<% const priceDiscount=Math.round(((product.regularPrice
																	- product.salePrice) / product.regularPrice) * 100);
																	if (priceDiscount> 0) {
																	%>
																	<span class="badge bg-success ms-2">
																		<%= priceDiscount %>% OFF
																	</span>
																	<% } %>
																		<% } %>
														</div>
														<% if (product.categoryOffer> 0) { %>
															<span class="badge bg-danger">
																<%= product.categoryOffer %>% Category OFF
															</span>
															<% } %>
													</div>
													<p class="card-text mt-2 text-muted">
														<%= product.description %>
													</p>
												</div>
								</a>
							</div>
						</div>
						<% }) %>
							<% } else { %>
								<div class="col-12">
									<div class="alert alert-info text-center">
										No products available at this time.
									</div>
								</div>
								<% } %>
			</div>
			<!-- Pagination -->
			<div class="container mt-4 mb-5">
				<nav aria-label="Product navigation">
					<ul class="pagination justify-content-center">
						<% if (pagination.currentPage> 1) { %>
							<li class="page-item">
								<a class="page-link" href="#" data-page="<%= pagination.currentPage - 1 %>"
									aria-label="Previous">
									<span aria-hidden="true">&laquo;</span>
								</a>
							</li>
							<% } %>

								<% for(let i=1; i <=pagination.totalPages; i++) { %>
									<% if (i===1 || i===pagination.totalPages || (i>= pagination.currentPage - 2 && i <=
											pagination.currentPage + 2)) { %>
											<li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
												<a class="page-link" href="#" data-page="<%= i %>">
													<%= i %>
												</a>
											</li>
											<% } else if (i===pagination.currentPage - 3 || i===pagination.currentPage +
												3) { %>
												<li class="page-item disabled">
													<a class="page-link" href="#">...</a>
												</li>
												<% } %>
													<% } %>

														<% if (pagination.currentPage < pagination.totalPages) { %>
															<li class="page-item">
																<a class="page-link" href="#"
																	data-page="<%= pagination.currentPage + 1 %>"
																	aria-label="Next">
																	<span aria-hidden="true">&raquo;</span>
																</a>
															</li>
															<% } %>
					</ul>
				</nav>
				<div class="text-center text-muted">
					Showing <%= (pagination.currentPage - 1) * pagination.limit + 1 %>-<%=
							Math.min(pagination.currentPage * pagination.limit, pagination.totalProducts) %> of <%=
								pagination.totalProducts %> products
				</div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="js/bootstrap.bundle.min.js"></script>
		<script src="js/tiny-slider.js"></script>
		<script src="js/custom.js"></script>
		<script>

			function handlePagination(page) {
				const params = updateQueryParams({ page: page });
				fetchAndRender(params);
			}
			function updateQueryParams(newParams) {
				const urlParams = new URLSearchParams(window.location.search);
				for (const [key, value] of Object.entries(newParams)) {
					if (value) {
						urlParams.set(key, value);
					} else {
						urlParams.delete(key);
					}
				}
				return urlParams.toString();
			}

			async function fetchAndRender(params) {
				try {
					const response = await fetch(`/shop?${params}`, {
						headers: {
							'X-Requested-With': 'XMLHttpRequest'
						}
					});
					if (!response.ok) throw new Error('Network response was not ok');
					const data = await response.json();


					const newUrl = `${window.location.pathname}?${params}`;
					window.history.pushState({ path: newUrl }, '', newUrl);

					location.reload();
				} catch (error) {
					console.error('Error:', error);
				}
			}

			function sortProducts(sortValue) {
				const params = updateQueryParams({ sort: sortValue });
				fetchAndRender(params);
			}

			function filterByPrice(range) {
				const params = updateQueryParams({ priceRange: range });
				fetchAndRender(params);
			}


			document.querySelector('.search-bar form').addEventListener('submit', function (e) {
				e.preventDefault();
				const searchValue = this.querySelector('input[name="search"]').value;
				const params = updateQueryParams({ search: searchValue });
				fetchAndRender(params);
			});

			document.querySelectorAll('.category-pills .nav-link').forEach(link => {
				link.addEventListener('click', function (e) {
					
					e.preventDefault();
					
					let params;

					if (this.getAttribute('href') === '/shop') {

						params = updateQueryParams({ category: '' });
					} else {

						const categoryId = new URL(this.href).searchParams.get('category');
						params = updateQueryParams({ category: categoryId });
					}

					fetchAndRender(params);
				});
			});

			document.addEventListener('click', function(e) {
    if (e.target.closest('.pagination .page-link')) {
        e.preventDefault();
        const pageLink = e.target.closest('.pagination .page-link');
        const page = pageLink.getAttribute('data-page');
        if (page) {
            handlePagination(page);
        }
    }
});
		</script>
</body>

</html>